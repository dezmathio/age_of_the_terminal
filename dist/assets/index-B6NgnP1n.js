(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))n(t);new MutationObserver(t=>{for(const i of t)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function r(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerPolicy&&(i.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?i.credentials="include":t.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(t){if(t.ep)return;t.ep=!0;const i=r(t);fetch(t.href,i)}})();const R={n:"north",s:"south",e:"east",w:"west",u:"up",d:"down"};function S(e){const o=e.trim();if(!o)return{verb:"",noun:null,raw:o};const r=o.toLowerCase().split(/\s+/),n=r[0]??"",t=r[1]??null;return r.length===1&&R[n]?{verb:"go",noun:R[n],raw:o}:{verb:n,noun:t,raw:o}}const L={torch:{id:"torch",name:"torch",description:"A crude torch that casts a flickering light.",slot:"light"},broadsword:{id:"broadsword",name:"broadsword",description:"A Cimmerian broadsword, heavy and sharp.",slot:"weapon"},brass_key:{id:"brass_key",name:"brass key",description:"An ancient brass key, green with age."},jewel:{id:"jewel",name:"jewel of the serpent",description:"A blood-red jewel carved in the shape of a serpent."},iron_key:{id:"iron_key",name:"iron key",description:"A cold iron key, stained with dried blood."},crown:{id:"crown",name:"crown of the serpent king",description:"A crown of black iron and rubies, worn by the serpent cult's high priest."}},$={id:"tower",name:"The Ruined Tower",rooms:[{id:"field",name:"West of the Ruined Tower",description:"You stand in a windswept field. To the east, a crumbling tower rises against the sky. The grass is brown and dead. Something stirs in the shadows.",exits:{east:"tower_entrance"},items:[]},{id:"tower_entrance",name:"Tower Entrance",description:"The door of the tower hangs open. Dust and bones litter the threshold. Stairs lead down into darkness. A rusty sconce holds an unlit torch.",exits:{west:"field",down:"hall"},items:["torch","broadsword"]},{id:"hall",name:"Hall of Serpents",description:"A long hall. Serpents are carved into the walls, their eyes seeming to follow you. To the north, a heavy door bars the way. To the east, an antechamber. To the south, the stairs lead back up.",exits:{south:"tower_entrance",north:"sanctum",east:"antechamber"},items:[],dark:!0},{id:"antechamber",name:"Antechamber",description:"A small room. Skeletons in rusted mail lie against the walls. A brass key glints on the floor.",exits:{west:"hall"},items:["brass_key"],dark:!0},{id:"sanctum",name:"The Sanctum",description:"A circular chamber. An altar of black stone stands in the center. Upon it rests a blood-red jewel. The walls bear runes that make your head ache to look upon.",exits:{south:"hall"},items:["jewel"]}],startRoomId:"field",winCondition:{roomId:"sanctum",itemId:"jewel"},maxScore:12,lockedExits:[{fromRoomId:"hall",toRoomId:"sanctum",direction:"north",keyId:"brass_key",flag:"sanctum_door_open"}]},N={id:"vault",name:"The Serpent Vault",rooms:[{id:"passage",name:"Dark Passage",description:"A narrow passage hewn from rock. To the north, a heavy iron door bars the way. A rusty sconce holds an unlit torch. An iron key hangs on a hook.",exits:{north:"chamber"},items:["torch","iron_key"]},{id:"chamber",name:"Chamber of Echoes",description:"A vast chamber. Your footsteps echo. Bones and broken weapons litter the floor. To the south, the passage back. To the west, an archway leads deeper.",exits:{south:"passage",west:"altar_room"},items:[],dark:!0},{id:"altar_room",name:"Altar of the Serpent",description:"A smaller chamber. An altar of obsidian gleams in the torchlight. Upon it rests a crown of black iron and rubies—the crown of the serpent king.",exits:{east:"chamber"},items:["crown"],dark:!0}],startRoomId:"passage",winCondition:{roomId:"altar_room",itemId:"crown"},maxScore:14,lockedExits:[{fromRoomId:"passage",toRoomId:"chamber",direction:"north",keyId:"iron_key",flag:"vault_door_open"}]},g=["tower","vault"],h=new Map;h.set("tower",$);h.set("vault",N);const C=new Map;for(const[e,o]of h){const r=new Map;for(const n of o.rooms)r.set(n.id,{...n,items:[...n.items]});C.set(e,r)}function y(e){return h.get(e)}function f(e,o){var r;return(r=C.get(e))==null?void 0:r.get(o)}function u(e){return L[e]}function j(e){return Object.keys(e.exits)}function D(){return g[0]}function P(e){const o=g.indexOf(e);return o===-1||o>=g.length-1?null:g[o+1]}function q(e){const o=h.get(e);return(o==null?void 0:o.startRoomId)??"field"}function M(e){const o=h.get(e);return(o==null?void 0:o.maxScore)??0}function F(e,o){return e.inventory.has(o)}function W(e,o){return e.inventory.delete(o)}function B(e,o,r){const n=u(o);return!n||!e.inventory.has(o)||n.slot&&n.slot!==r?!1:(e.equipped.set(r,o),!0)}function b(e){return e.equipped.get("light")!=null}function V(e){const o=[];if(e.inventory.size===0)return"You carry nothing.";const r=Array.from(e.inventory).map(n=>{var t;return((t=u(n))==null?void 0:t.name)??n}).join(", ");if(o.push(`You carry: ${r}.`),e.equipped.size>0){const n=[];e.equipped.forEach((t,i)=>{var a;const s=((a=u(t))==null?void 0:a.name)??t;n.push(`${i} → ${s}`)}),o.push(`Wielded: ${n.join(", ")}`)}return o.join(`
`)}const G=`
 █████╗  ██████╗ ███████╗     ██████╗ ███████╗                   
██╔══██╗██╔════╝ ██╔════╝    ██╔═══██╗██╔════╝                   
███████║██║  ███╗█████╗      ██║   ██║█████╗                     
██╔══██║██║   ██║██╔══╝      ██║   ██║██╔══╝                     
██║  ██║╚██████╔╝███████╗    ╚██████╔╝██║                        
╚═╝  ╚═╝ ╚═════╝ ╚══════╝     ╚═════╝ ╚═╝ 
the
████████╗███████╗██████╗ ███╗   ███╗██╗███╗   ██╗ █████╗ ██╗     
╚══██╔══╝██╔════╝██╔══██╗████╗ ████║██║████╗  ██║██╔══██╗██║     
   ██║   █████╗  ██████╔╝██╔████╔██║██║██╔██╗ ██║███████║██║     
   ██║   ██╔══╝  ██╔══██╗██║╚██╔╝██║██║██║╚██╗██║██╔══██║██║     
   ██║   ███████╗██║  ██║██║ ╚═╝ ██║██║██║ ╚████║██║  ██║███████╗
   ╚═╝   ╚══════╝╚═╝  ╚═╝╚═╝     ╚═╝╚═╝╚═╝  ╚═══╝╚═╝  ╚═╝╚══════╝
                                                                                                                                                                                              
                                                                 
              ~~~ A Conan Fan Game ~~~
`,x="══════════════════════════════════════════════════════════════",U=`
  ╔═══════════════════════════════════╗
  ║         B Y   C R O M !          ║
  ║         You have fallen.         ║
  ╚═══════════════════════════════════╝
`,H=`
  ╔═══════════════════════════════════════════════════╗
  ║     The throne is yours…                          ║
  ║     You have conquered the tower.                ║
  ╚═══════════════════════════════════════════════════╝
`,z=`
  ╔═══════════════════════════════════════════════════╗
  ║     Map complete! A new quest awaits…            ║
  ╚═══════════════════════════════════════════════════╝
`,K=new Set(["north","south","east","west","up","down","n","s","e","w","u","d"]);function v(e,o){const r=f(e.currentMapId,o);if(!r)return"You are nowhere.";const n=r.dark&&!b(e),t=[x,r.name,x,""];if(n)return t.push("It is too dark to see. Light a torch or find another source of light."),t.join(`
`);if(t.push(r.description),t.push(""),r.items.length>0){const s=r.items.map(a=>{var c;return((c=u(a))==null?void 0:c.name)??a}).join(", ");t.push(`You see: ${s}.`),t.push("")}const i=j(r);return i.length>0&&t.push(`Exits: ${i.join(", ")}.`),t.join(`
`)}function T(e,o){var a;const r=f(e.currentMapId,e.currentRoomId);if(!r)return"You are nowhere.";const n=o==="n"?"north":o==="s"?"south":o==="e"?"east":o==="w"?"west":o==="u"?"up":o==="d"?"down":o,t=r.exits[n];if(!t)return`You cannot go ${n}.`;const i=y(e.currentMapId),s=(a=i==null?void 0:i.lockedExits)==null?void 0:a.find(c=>c.fromRoomId===r.id&&c.toRoomId===t&&c.direction===n);return s&&!e.globalFlags.has(s.flag)?`The door to the ${n} is locked. You need a key.`:(e.currentRoomId=t,v(e,e.currentRoomId))}function J(e,o){var s;const r=f(e.currentMapId,e.currentRoomId);if(!r)return"You are nowhere.";if(r.dark&&!b(e))return"It is too dark to see.";const n=A(o,r.items);if(!n)return`You don't see "${o}" here.`;if(e.inventory.has(n))return`You already have the ${((s=u(n))==null?void 0:s.name)??n}.`;e.inventory.add(n),e.score+=2;const t=r.items.indexOf(n);t!==-1&&r.items.splice(t,1);const i=y(e.currentMapId);return(i==null?void 0:i.winCondition.roomId)===e.currentRoomId&&i.winCondition.itemId===n&&(e.score+=3,e.won=!0,e.gameOver=!0),"Taken."}function A(e,o){const r=e.toLowerCase().replace(/\s+/g,"_");for(const n of o){const t=u(n);if(t&&(n===r||t.name.toLowerCase()===e.toLowerCase()||t.name.toLowerCase().replace(/\s+/g,"_").includes(r)))return n}return null}function Q(e,o){const r=f(e.currentMapId,e.currentRoomId);if(!r)return"You are nowhere.";const n=E(e,o);return n?(W(e,n),r.items.push(n),"Dropped."):`You don't have "${o}".`}function E(e,o){const r=o.toLowerCase().replace(/\s+/g,"_");for(const n of e.inventory){const t=u(n);if(t&&(n===r||t.name.toLowerCase()===o.toLowerCase()||t.name.toLowerCase().includes(o.toLowerCase())))return n}return null}function X(e,o){const r=f(e.currentMapId,e.currentRoomId);if(!r)return"You are nowhere.";const n=r.dark&&!b(e)?null:A(o,r.items),t=E(e,o),i=n??t;if(!i)return`You don't see "${o}" here.`;const s=u(i);return(s==null?void 0:s.description)??"You see nothing special."}function Z(e,o){var i,s;if(!o||!o.toLowerCase().includes("door"))return"Open what?";const r=f(e.currentMapId,e.currentRoomId);if(!r)return"You are nowhere.";const n=y(e.currentMapId),t=(i=n==null?void 0:n.lockedExits)==null?void 0:i.find(a=>a.fromRoomId===r.id);return t?e.globalFlags.has(t.flag)?"The door is already open.":F(e,t.keyId)?(e.globalFlags.add(t.flag),e.score+=3,`You unlock the heavy door with the ${((s=u(t.keyId))==null?void 0:s.name)??t.keyId}. It swings open.`):"You don't have the key.":"There is no door to open here."}function ee(e,o){const r=E(e,o);if(!r)return`You don't have "${o}".`;const n=u(r);if(!n)return"You can't wield that.";const t=n.slot==="weapon"?"weapon":n.slot==="light"?"light":null;return t?(B(e,r,t),`You ${t==="weapon"?"wield":"light"} the ${n.name}.`):"You can't wield that."}function oe(e,o,r){const n=o.toLowerCase(),t=(r??"").trim()||null;return n==="go"&&t&&K.has(t)?{message:T(e,t),state:e}:n==="n"||n==="s"||n==="e"||n==="w"||n==="u"||n==="d"?{message:T(e,n),state:e}:n==="take"||n==="get"?t?{message:J(e,t),state:e}:{message:"Take what?",state:e}:n==="drop"?t?{message:Q(e,t),state:e}:{message:"Drop what?",state:e}:n==="examine"||n==="x"?t?{message:X(e,t),state:e}:{message:"Examine what?",state:e}:n==="inventory"||n==="i"?{message:V(e),state:e}:n==="open"?{message:Z(e,t??""),state:e}:n==="wield"||n==="wear"||n==="light"?t?{message:ee(e,t),state:e}:{message:"Wield what?",state:e}:n==="look"||n==="l"?{message:v(e,e.currentRoomId),state:e}:n==="score"?{message:`Your score: ${e.score} / ${M(e.currentMapId)}.`,state:e}:n==="help"||n==="?"?{message:"Commands: go (n/s/e/w), take, drop, examine (x), inventory (i), open, wield, look (l), score, help (?)",state:e}:n===""?{message:"",state:e}:{message:`I don't understand "${o}${t?" "+t:""}".`,state:e}}function _(e){return v(e,e.currentRoomId)}const Y=document.getElementById("title"),w=document.getElementById("output"),m=document.getElementById("input");function O(e){const o=e??D();return{currentMapId:o,currentRoomId:q(o),inventory:new Set,equipped:new Map,roomFlags:new Map,globalFlags:new Set,score:0,maxScore:M(o),gameOver:!1,won:!1}}let d=O();function l(e,o){const r=document.createElement("div");r.className=o??"line",r.textContent=e,w.appendChild(r)}function p(e,o){e.split(`
`).forEach(r=>l(r,o))}function I(e,o){const r=document.createElement("div");r.className=o??"line",r.textContent=e,Y.appendChild(r)}function ne(){const e=document.createElement("div");e.className="line",e.appendChild(document.createTextNode("Type a command and press Enter. Try: ")),["go east","take torch","inventory","look","help"].forEach((r,n)=>{n>0&&e.appendChild(document.createTextNode(", "));const t=document.createElement("span");t.className="keyword",t.textContent=r,e.appendChild(t)}),Y.appendChild(e)}function te(){G.trim().split(`
`).forEach(e=>I(e,"line title")),I(""),ne(),I("")}function re(){te(),p(_(d))}function k(){const e=w.lastElementChild;e?e.scrollIntoView({block:"end",behavior:"auto"}):w.scrollTop=w.scrollHeight}function ie(e){const o=e.trim();if(!o)return;const r=document.createElement("div");r.className="input-echo",r.textContent=`> ${o}`,w.appendChild(r);const{verb:n,noun:t}=S(o),{message:i,state:s}=oe(d,n,t);if(d=s,i&&p(i),d.gameOver&&d.won){const a=P(d.currentMapId);if(a){l(""),p(z.trim()),l("");const c=y(a);l(`You descend into ${(c==null?void 0:c.name)??"the unknown"}...`,"line"),l(""),d=O(a),p(_(d)),k();return}}if(d.gameOver){l(""),p(d.won?H.trim():U.trim()),l(""),l("Refresh the page to play again."),m.disabled=!0,m.placeholder="";return}k()}function se(e){e.preventDefault();const o=m.value;m.value="",ie(o)}re();m.focus();m.addEventListener("keydown",e=>{e.key==="Enter"&&(e.preventDefault(),se(e))});k();
