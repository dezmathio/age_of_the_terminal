(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function t(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(o){if(o.ep)return;o.ep=!0;const s=t(o);fetch(o.href,s)}})();const v={n:"north",s:"south",e:"east",w:"west",u:"up",d:"down"};function T(e){const r=e.trim();if(!r)return{verb:"",noun:null,raw:r};const t=r.toLowerCase().split(/\s+/),n=t[0]??"",o=t[1]??null;return t.length===1&&v[n]?{verb:"go",noun:v[n],raw:r}:{verb:n,noun:o,raw:r}}const Y={torch:{id:"torch",name:"torch",description:"A crude torch that casts a flickering light.",slot:"light"},broadsword:{id:"broadsword",name:"broadsword",description:"A Cimmerian broadsword, heavy and sharp.",slot:"weapon"},brass_key:{id:"brass_key",name:"brass key",description:"An ancient brass key, green with age."},jewel:{id:"jewel",name:"jewel of the serpent",description:"A blood-red jewel carved in the shape of a serpent."}},E=[{id:"field",name:"West of the Ruined Tower",description:"You stand in a windswept field. To the east, a crumbling tower rises against the sky. The grass is brown and dead. Something stirs in the shadows.",exits:{east:"tower_entrance"},items:[]},{id:"tower_entrance",name:"Tower Entrance",description:"The door of the tower hangs open. Dust and bones litter the threshold. Stairs lead down into darkness. A rusty sconce holds an unlit torch.",exits:{west:"field",down:"hall"},items:["torch"]},{id:"hall",name:"Hall of Serpents",description:"A long hall. Serpents are carved into the walls, their eyes seeming to follow you. To the north, a heavy door bars the way. To the east, an antechamber. To the south, the stairs lead back up.",exits:{south:"tower_entrance",north:"sanctum",east:"antechamber"},items:[],dark:!0},{id:"antechamber",name:"Antechamber",description:"A small room. Skeletons in rusted mail lie against the walls. A brass key glints on the floor.",exits:{west:"hall"},items:["brass_key"],dark:!0},{id:"sanctum",name:"The Sanctum",description:"A circular chamber. An altar of black stone stands in the center. Upon it rests a blood-red jewel. The walls bear runes that make your head ache to look upon.",exits:{south:"hall"},items:["jewel"]}],L=new Map(E.map(e=>[e.id,e]));function l(e){return L.get(e)}function a(e){return Y[e]}function C(e){return Object.keys(e.exits)}function S(){return"field"}function k(){return 12}function x(e,r){return e.inventory.has(r)}function A(e,r){return e.inventory.delete(r)}function $(e,r,t){const n=a(r);return!n||!e.inventory.has(r)||n.slot&&n.slot!==t?!1:(e.equipped.set(t,r),!0)}function p(e){return e.equipped.get("light")!=null}function j(e){const r=[];if(e.inventory.size===0)return"You carry nothing.";const t=Array.from(e.inventory).map(n=>{var o;return((o=a(n))==null?void 0:o.name)??n}).join(", ");if(r.push(`You carry: ${t}.`),e.equipped.size>0){const n=[];e.equipped.forEach((o,s)=>{var d;const i=((d=a(o))==null?void 0:d.name)??o;n.push(`${s} → ${i}`)}),r.push(`Wielded: ${n.join(", ")}`)}return r.join(`
`)}const D=`
  ___          _        _____ _____ _   _ ___ ____  _____ __  __
 / _ \\   _ __ | | ___  |_   _|_   _| | | |_ _|  _ \\| ____|  \\/  |
| | | | | '_ \\| |/ _ \\   | |   | | | |_| || || |_) |  _| | |\\/| |
| |_| | | | | | |  __/   | |   | | |  _  || ||  _ <| |___| |  | |
 \\__\\_\\ |_| |_|_|\\___|   |_|   |_| |_| |_|___|_| \\_\\_____|_|  |_|
     |___|
  ~~~ A Conan Fan Game ~~~
`,b="══════════════════════════════════════════════════════════════",M=`
  ╔═══════════════════════════════════╗
  ║         B Y   C R O M !          ║
  ║         You have fallen.         ║
  ╚═══════════════════════════════════╝
`,N=`
  ╔═══════════════════════════════════════════════════╗
  ║     The throne is yours…                          ║
  ║     You have conquered the tower.                ║
  ╚═══════════════════════════════════════════════════╝
`,F=new Set(["north","south","east","west","up","down","n","s","e","w","u","d"]),_="sanctum_door_open";function w(e,r){const t=l(r);if(!t)return"You are nowhere.";const n=t.dark&&!p(e),o=[b,t.name,b,""];if(n)return o.push("It is too dark to see. Light a torch or find another source of light."),o.join(`
`);if(o.push(t.description),o.push(""),t.items.length>0){const i=t.items.map(d=>{var y;return((y=a(d))==null?void 0:y.name)??d}).join(", ");o.push(`You see: ${i}.`),o.push("")}const s=C(t);return s.length>0&&o.push(`Exits: ${s.join(", ")}.`),o.join(`
`)}function I(e,r){const t=l(e.currentRoomId);if(!t)return"You are nowhere.";const n=r==="n"?"north":r==="s"?"south":r==="e"?"east":r==="w"?"west":r==="u"?"up":r==="d"?"down":r,o=t.exits[n];return o?o==="sanctum"&&t.id==="hall"&&!e.globalFlags.has(_)?"The door to the north is locked. You need a key.":(e.currentRoomId=o,w(e,e.currentRoomId)):`You cannot go ${n}.`}function q(e,r){var s;const t=l(e.currentRoomId);if(!t)return"You are nowhere.";if(t.dark&&!p(e))return"It is too dark to see.";const n=R(r,t.items);if(!n)return`You don't see "${r}" here.`;if(e.inventory.has(n))return`You already have the ${((s=a(n))==null?void 0:s.name)??n}.`;e.inventory.add(n),e.score+=2;const o=t.items.indexOf(n);return o!==-1&&t.items.splice(o,1),e.currentRoomId==="sanctum"&&n==="jewel"&&(e.won=!0,e.gameOver=!0,e.score+=3),"Taken."}function R(e,r){const t=e.toLowerCase().replace(/\s+/g,"_");for(const n of r){const o=a(n);if(o&&(n===t||o.name.toLowerCase()===e.toLowerCase()||o.name.toLowerCase().replace(/\s+/g,"_").includes(t)))return n}return null}function W(e,r){const t=l(e.currentRoomId);if(!t)return"You are nowhere.";const n=g(e,r);return n?(A(e,n),t.items.push(n),"Dropped."):`You don't have "${r}".`}function g(e,r){const t=r.toLowerCase().replace(/\s+/g,"_");for(const n of e.inventory){const o=a(n);if(o&&(n===t||o.name.toLowerCase()===r.toLowerCase()||o.name.toLowerCase().includes(r.toLowerCase())))return n}return null}function P(e,r){const t=l(e.currentRoomId);if(!t)return"You are nowhere.";const n=t.dark&&!p(e)?null:R(r,t.items),o=g(e,r),s=n??o;if(!s)return`You don't see "${r}" here.`;const i=a(s);return(i==null?void 0:i.description)??"You see nothing special."}function B(e,r){if(!r||!r.toLowerCase().includes("door"))return"Open what?";const t=l(e.currentRoomId);return!t||t.id!=="hall"?"There is no door to open here.":e.globalFlags.has(_)?"The door is already open.":x(e,"brass_key")?(e.globalFlags.add(_),e.score+=3,"You unlock the heavy door with the brass key. It swings open."):"You don't have the key."}function G(e,r){const t=g(e,r);if(!t)return`You don't have "${r}".`;const n=a(t);if(!n)return"You can't wield that.";const o=n.slot==="weapon"?"weapon":n.slot==="light"?"light":null;return o?($(e,t,o),`You ${o==="weapon"?"wield":"light"} the ${n.name}.`):"You can't wield that."}function U(e,r,t){const n=r.toLowerCase(),o=(t??"").trim()||null;return n==="go"&&o&&F.has(o)?{message:I(e,o),state:e}:n==="n"||n==="s"||n==="e"||n==="w"||n==="u"||n==="d"?{message:I(e,n),state:e}:n==="take"||n==="get"?o?{message:q(e,o),state:e}:{message:"Take what?",state:e}:n==="drop"?o?{message:W(e,o),state:e}:{message:"Drop what?",state:e}:n==="examine"||n==="x"?o?{message:P(e,o),state:e}:{message:"Examine what?",state:e}:n==="inventory"||n==="i"?{message:j(e),state:e}:n==="open"?{message:B(e,o??""),state:e}:n==="wield"||n==="wear"||n==="light"?o?{message:G(e,o),state:e}:{message:"Wield what?",state:e}:n==="look"||n==="l"?{message:w(e,e.currentRoomId),state:e}:n==="score"?{message:`Your score: ${e.score} / ${k()}.`,state:e}:n===""?{message:"",state:e}:{message:`I don't understand "${r}${o?" "+o:""}".`,state:e}}function z(e){return w(e,e.currentRoomId)}const m=document.getElementById("output"),c=document.getElementById("input");function H(){return{currentRoomId:S(),inventory:new Set,equipped:new Map,roomFlags:new Map,globalFlags:new Set,score:0,maxScore:k(),gameOver:!1,won:!1}}let h=H();function u(e,r){const t=document.createElement("div");t.className=r??"line",t.textContent=e,m.appendChild(t)}function f(e,r){e.split(`
`).forEach(t=>u(t,r))}function V(){f(D.trim(),"line title"),u(""),u("Type a command and press Enter. Try: go east, take torch, inventory, look."),u("")}function K(){V(),f(z(h))}function O(){m.scrollTop=m.scrollHeight}function J(e){const r=e.trim();if(!r)return;const t=document.createElement("div");t.className="input-echo",t.textContent=`> ${r}`,m.appendChild(t);const{verb:n,noun:o}=T(r),{message:s,state:i}=U(h,n,o);if(h=i,s&&f(s),h.gameOver){u(""),f(h.won?N.trim():M.trim()),u(""),u("Refresh the page to play again."),c.disabled=!0,c.placeholder="";return}O()}function Q(e){e.preventDefault();const r=c.value;c.value="",J(r)}K();c.focus();c.addEventListener("keydown",e=>{e.key==="Enter"&&(e.preventDefault(),Q(e))});O();
